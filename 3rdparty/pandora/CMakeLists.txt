PROJECT(pandorahck)
SET(PANDORAHCK_SRC src/pandorahck.c)

OPTION(PANDORAHCK_NO_GRAB "Disable X11 input grabbing from pandorahck" OFF)
OPTION(PANDORAHCK_NO_FRAMEBUFFER "Disable framebuffer mode from  pandorahck" OFF)

IF (PANDORAHCK_NO_GRAB)
   MESSAGE("Disabling input grab from libpandorahck")
   ADD_DEFINITIONS(-DPANDORAHCK_NO_GRAB=1)
ENDIF ()

IF (PANDORAHCK_NO_FRAMEBUFFER)
   MESSAGE("Disabling framebuffer mode from libpandorahck")
   ADD_DEFINITIONS(-DPANDORAHCK_NO_FRAMEBUFFER=1)
ENDIF ()

IF (UNIX AND (CMAKE_COMPILER_IS_GNUCC OR CMAKE_COMPILER_IS_GNUCXX))
   SET(CMAKE_POSITION_INDEPENDENT_CODE ON)
   IF (${CMAKE_VERSION} VERSION_LESS 2.8.9)
      ADD_DEFINITIONS(-fPIC)
   ENDIF ()
ENDIF ()

IF (CMAKE_COMPILER_IS_GNUCC OR CMAKE_COMPILER_IS_GNUCXX OR "${CMAKE_C_COMPILER_ID}" STREQUAL "Clang")
   ADD_DEFINITIONS(-std=c99)
ENDIF ()

ADD_LIBRARY(pandorahck SHARED ${PANDORAHCK_SRC})
TARGET_LINK_LIBRARIES(pandorahck)
INSTALL(TARGETS pandorahck DESTINATION preload)
